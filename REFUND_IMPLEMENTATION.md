# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–µ–π

–í –ø—Ä–æ–µ–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ MAIB API —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ `refund.md`.

## –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ MAIBPaymentService

**–§–∞–π–ª:** `src/lib/payments/maib.ts`

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
- `MAIBRefundRequest` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
- `MAIBRefundResponse` - –æ—Ç–≤–µ—Ç –æ—Ç MAIB API

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥:**
- `refundPayment(request: MAIBRefundRequest)` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç —á–µ—Ä–µ–∑ MAIB API

### 2. API Endpoint –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞

**–§–∞–π–ª:** `src/app/api/payments/refund/route.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å completed –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —á–µ—Ä–µ–∑ MAIB
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "paymentId": "uuid –ø–ª–∞—Ç–µ–∂–∞",
  "refundAmount": 10.25  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞
}
```

### 3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

**–§–∞–π–ª:** `src/components/admin/refund-payment.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤—ã–±–æ—Ä–æ–º —Ç–∏–ø–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ (–ø–æ–ª–Ω—ã–π/—á–∞—Å—Ç–∏—á–Ω—ã–π)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞

### 4. –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

**–§–∞–π–ª:** `test-refund.js`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å MAIB API

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### API Endpoint

```bash
# –ü–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
curl -X POST /api/payments/refund \
  -H "Content-Type: application/json" \
  -d '{"paymentId": "payment-uuid"}'

# –ß–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
curl -X POST /api/payments/refund \
  -H "Content-Type: application/json" \
  -d '{"paymentId": "payment-uuid", "refundAmount": 50.00}'
```

### –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:
```tsx
import { RefundPayment } from '@/components/admin/refund-payment'
```

2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ —Å–ø–∏—Å–∫–µ –ø–ª–∞—Ç–µ–∂–µ–π:
```tsx
<RefundPayment 
  payment={payment} 
  onRefundComplete={() => refreshPayments()}
/>
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
node test-refund.js
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ payments

–ü–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ `metadata` –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—è:

```json
{
  "refund_status": "refunded" | "partially_refunded",
  "refund_amount": 50.00,
  "refund_date": "2024-01-01T12:00:00.000Z",
  "maib_refund_response": {
    "payId": "maib-pay-id",
    "orderId": "order-id",
    "status": "OK",
    "statusCode": "400",
    "statusMessage": "Accepted"
  }
}
```

### –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π

- `completed` - –æ–ø–ª–∞—á–µ–Ω, –≤–æ–∑–≤—Ä–∞—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è
- `completed` + `metadata.refund_status: "partially_refunded"` - —á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
- `refunded` - –ø–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MAIB

1. **–û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞:** –í–æ–∑–≤—Ä–∞—Ç –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
2. **–ß–∞—Å—Ç–∏—á–Ω—ã–π + –ø–æ–ª–Ω—ã–π:** –ï—Å–ª–∏ –±—ã–ª —á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç, –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Å—Ç–∞—Ç–∫–∞ –Ω—É–∂–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É MAIB
3. **–ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏:** ecom@maib.md

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–æ–∑–≤—Ä–∞—Ç –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –ø–ª–∞—Ç–µ–∂–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ (—Ç–æ–ª—å–∫–æ completed)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ API:

- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `404` - –ü–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ –ø–ª–∞—Ç–µ–∂ —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –û—à–∏–±–∫–∏ MAIB:

- `12001` - –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä refundAmount
- `REVERSED` - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–∂–µ –±—ã–ª–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:
- `üîÑ` - –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `üìã` - –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞
- `‚úÖ` - –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- `‚ùå` - –û—à–∏–±–∫–∞

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –ø–ª–∞—Ç–µ–∂–µ–π –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.